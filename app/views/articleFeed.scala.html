@import java.util.Locale
@import domain.ArticlesSection
@import views.form.PostArticleForm
@import domain.User
@(articlesSection: ArticlesSection, form: Form[PostArticleForm], users: Seq[User], postUrl: Call)(implicit request: RequestHeader, messages: Messages)

@userOptions = @{
  users.map { user =>
    (user.id.toString, user.username)
  }
}

@currentPage = @{
  articlesSection.index / articlesSection.articles.size + 1
}

@totalPagesCount = @{
  (articlesSection.totalArticleAmount / articlesSection.articles.size + 1) + 1
}

@main("Article Feed") {

  @* Post Article *@
  @helper.form(postUrl) {

    @helper.CSRF.formField
    @helper.textarea(form("body"), 'required -> true, 'title -> "Article Text")
    @helper.select(form("userId"), userOptions)

    <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Post Article</button>
  }



  @* Article Feed *@

  @{
    articlesSection.articles.map { article =>
        <div class="card mt-2">
          <div class="card-header">
            <a href="#">{article.user.username}</a> on {article.created.toString("dd. MMM yyyy ' at ' k:m:ss", Locale.ENGLISH)}
          </div>
          <div class="card-body">
            <p class="card-text">{article.body}</p>
          </div>
          <div class="card-footer text-muted">
            <a href={s"/article/${article.id}"} class="badge badge-light">Comments</a>
          </div>
        </div>

    }
  }

  @* Pagination *@
  <nav class="mt-3">
    <ul class="pagination justify-content-center">
      <li class="page-item @if(currentPage == 1){disabled} ">
        <a class="page-link" href="@{currentPage - 1}">Previous</a>
      </li>
      @for(i <- 1 to totalPagesCount) {
        <li class="page-item @if(i == currentPage){active} ">
          <a class="page-link" href="@{i}">
            @{i}
          </a>
        </li>
      }
      <li class="page-item @if(currentPage == totalPagesCount){disabled}">
        <a class="page-link" href="@{currentPage + 1}">Next</a>
      </li>
    </ul>
  </nav>
}

